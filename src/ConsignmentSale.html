<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Sale Tag Generator</title>
  <script src="./js/vue.global.prod.js"></script>
  <script src="./js/bwip-js-min.js"></script>
  <link rel="stylesheet" href="./style/index.css" />
  <link rel="stylesheet" href="./style/print.css" />
  <link rel="stylesheet" href="./style/index.css" />
</head>

<body>
  <div class="noPrint alert-warning">
    <span class="alert-icon">‚ö†Ô∏è</span>
    Safari on macOS isn‚Äôt supported. For the best experience, please try Chrome, Firefox, or another browser.
  </div>
  <div id="app">
    <div class="noPrint">
      <a style="position: fixed; right: 0px; top: 0px;" href="https://github.com/kucksdorfs"><img loading="lazy"
          decoding="async" width="149" height="149"
          src="https://github.blog/wp-content/uploads/2008/12/forkme_right_red_aa0000.png"
          class="attachment-full size-full" alt="Fork me on GitHub"></a>
      <div id="edit-data">
        <h1>Seller Table</h1>
        <div class="controls">
          <label>Seller ID:
            <input id="txtSellerId" v-model="sellerData.sellerId" placeholder="Enter Seller ID" />
          </label>
        </div>
        <div class="controls">
          <div>
            <span style="float:left;">
              <button @click="addItem">Add Item</button>
              <input id="fileInput" type="file" @change="importFromJSON" style="display:none;" />
              <button class="debugData hide" @click="exportAsJSON">‚¨á Download tag file</button>
              <button class="debugData hide" onclick="document.getElementById('fileInput').click()">‚¨Ü Import tag
                file</button>
              <button @click="printGrid">Print Grid</button>
              <button @click="exportGridToCSV">Export CSV</button>
            </span>
            <span style="float:right;">
              <button @click="removeSelected">Remove Selected</button>
              <button @click="clearAllItems">Remove All</button>
            </span>
          </div>
        </div>
        <div class="printOnly" style="margin-top: 0;">
          <strong>Seller ID:</strong> {{ sellerData.sellerId }}
        </div>
        <table>
          <thead>
            <tr>
              <th style="width:40px;"><label class="SkipStyling">Select
                  <input v-model="sellerData.selectAll" @change="toggleSelectAll" type="checkbox" />
                </label>
              </th>
              <th style="width:40px;">Donate?<br />
                <label>Default Donation: <input title="Check to donate if the item doesn't sell." type="checkbox"
                    v-model="sellerData.defaultDonation" /></label>
              </th>
              <th style="width: 75px;">Gender<br /><label>Default Gender:
                  <select v-model="sellerData.defaultGender">
                    <option value="unmarked"> - </option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                  </select>
                </label>
              </th>
              <th>Description</th>
              <th style="width:40px;">Size<br>
                <label>Default Size: <input title="Check to donate if the item doesn't sell." type="textbox"
                    v-model="sellerData.defaultSize" /></label>
              </th>
              <th style="width:40px;">Price (‚â• 2)</th>
              <th style="width:40px;">
              </th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, index) in sellerData.items" :key="index" :class="item.price === 0 ? 'invalid' : '' ">
              <td style="text-align: center;">
                <label style="white-space: nowrap; display: inline-flex; align-items: center; gap: 0.3rem;">
                  {{ index + 1 }}
                  <input title="Select tag" type="checkbox" v-model="item.selected" @change="checkAllToggled(index)" />
                </label>
              </td>
              <td><input title="Check to donate if the item doesn't sell." type="checkbox" v-model="item.donation" />
              </td>
              <td>
                <select v-model="item.gender">
                  <option value="unmarked"> - </option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
              </td>
              <td>
                <textarea v-model="item.itemDescription" ref="rowRefs" rows="2"
                  style="width: 100%; max-height: 105px; min-height: 105px; resize:none;"></textarea>
              </td>

              <td><input v-model="item.size" /></td>
              <td>
                <input type="number" v-model.number="item.price" min="2" @change="validatePrice(item)"
                  :class="{ 'invalid-highlight': item.highlight }" />
              </td>
              <td><button style="margin-top:0px;" @click="addItem">Add</button></td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="totals-row">
              <td style="text-align:center; font-weight: bold;">Total Qty: {{ totals.count }}</td>
              <td colspan="4" style="text-align:right; font-weight: bold;">Totals (valid items)</td>
              <td style="font-weight: bold;">${{ totals.amount.toFixed(2) }}</td>
              <td></td>
            </tr>
            <tr class="totals-row">
              <td style="text-align:center; font-weight: bold;">Total Qty (selected): {{ selectedTotals.count }}</td>
              <td colspan="4" style="text-align:right; font-weight: bold;">Totals (selected items)</td>
              <td style="font-weight: bold;">${{ selectedTotals.amount.toFixed(2) }}</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <h2>Label Preview</h2>
      <button @click="print">üñ®Ô∏è Print All</button>
      <button @click="printSelected">üñ®Ô∏è‚òëÔ∏è Print Selected</button>
    </div>
    <div class="label-sheet">
      <div v-if="sellerData.sellerId.length == 0" class="printOnly">
        Please enter your seller ID.
      </div>
      <div :class="sellerData.sellerId.length > 0 && item.price > 0.0 && item.selected ? 'selected' : ''" class="label"
        v-for="(item, idx) in sellerData.items" :key="'label-'+idx">
        <div class="label-line label-header">
          <img src="./images/half_pint_logo_horz.jpg" />
        </div>
        <div class="label-line line">
          <span style="width: 33%; border-right: 2px dotted lightgrey;">
            <span :class="!item.donation ? 'crossed' : ''">D</span>
          </span>
          <span style="width: 65%;">
            <span :class="item.gender==='male'?'circled':''">B</span>
            <span> / </span>
            <span :class="item.gender==='female'?'circled':''">G</span>
          </span>
        </div>
        <div class="label-line item-desc">
          <div style="text-align: right; font-size: 24pt; font-style: italic;">Item</div>
          <div v-html="formatDescription(item.itemDescription)"></div>
        </div>
        <div class="label-line size">{{ item.size }}<span style="font-style: italic;">&nbsp;Size</span></div>
        <div class="label-line barcode">
          <div style="font-size: 8pt;">halfpintresale.com</div>
          <div>
            <canvas :ref="el=>drawBarcode(el,item)"></canvas>
          </div>
          <div class="price-seller">
            <span class="left">{{ sellerData.sellerId }}</span>
            <span class="right">${{ Number(item?.price || 0).toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="debugData noPrint hide">
      <h3>Debug Data:</h3>
      <pre>{{ sellerData }}</pre>
    </div>
  </div>
  <script type="text/javascript" src="./js/app.js"></script>
  <footer class="noPrint">
    &copy; 2025 Kucksdorfs. Licensed under the
    <a href="https://opensource.org/licenses/BSD-3-Clause" target="_blank">BSD 3-Clause License</a>.
  </footer>

</body>

</html>
